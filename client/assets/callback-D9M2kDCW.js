import{a as f,p as e,w as K,v as Y,x as z}from"./chunk-EPOLDU6W-BHelFxtI.js";import{s as p}from"./supabase-BO81Wobz.js";import{P as A,C as U,B as d}from"./card-DCCwVGqU.js";import{A as Z,b as J,a as Q}from"./alert-9_S9W-Db.js";import{c as W,K as ee,S as re,B as ae}from"./badge-z8JLICnP.js";import{c as L,a as ie,L as V}from"./loader-circle-B5kmy_fB.js";import{T as se,C as te,a as oe,M as ne}from"./triangle-alert-CiF5QaMf.js";import{M as le}from"./mail-BwQk4DBE.js";import"./index-BRs_dBEV.js";const ce=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],de=L("badge-check",ce);const me=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],j=L("refresh-cw",me);var w="Progress",C=100,[fe]=W(w),[ue,ge]=fe(w),M=f.forwardRef((i,t)=>{const{__scopeProgress:u,value:r=null,max:a,getValueLabel:k=he,...o}=i;(a||a===0)&&!S(a)&&console.error(xe(`${a}`,"Progress"));const l=S(a)?a:C;r!==null&&!I(r,l)&&console.error(ve(`${r}`,"Progress"));const m=I(r,l)?r:null,E=b(m)?k(m,l):void 0;return e.jsx(ue,{scope:u,value:m,max:l,children:e.jsx(A.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":b(m)?m:void 0,"aria-valuetext":E,role:"progressbar","data-state":T(m,l),"data-value":m??void 0,"data-max":l,...o,ref:t})})});M.displayName=w;var $="ProgressIndicator",R=f.forwardRef((i,t)=>{const{__scopeProgress:u,...r}=i,a=ge($,u);return e.jsx(A.div,{"data-state":T(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:t})});R.displayName=$;function he(i,t){return`${Math.round(i/t*100)}%`}function T(i,t){return i==null?"indeterminate":i===t?"complete":"loading"}function b(i){return typeof i=="number"}function S(i){return b(i)&&!isNaN(i)&&i>0}function I(i,t){return b(i)&&!isNaN(i)&&i<=t&&i>=0}function xe(i,t){return`Invalid prop \`max\` of value \`${i}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${C}\`.`}function ve(i,t){return`Invalid prop \`value\` of value \`${i}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${C} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var pe=M,be=R;function ke({className:i,value:t,...u}){return e.jsx(pe,{"data-slot":"progress",className:ie("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",i),...u,children:e.jsx(be,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const Ie=K(function(){const t=Y(),u=z(),[r,a]=f.useState("loading"),[k,o]=f.useState(""),[l,m]=f.useState(""),[E,g]=f.useState(null),[Ne,D]=f.useState(null),[_,h]=f.useState(0),F=()=>typeof window<"u"&&localStorage.getItem("pending_email")||"",x=()=>{typeof window<"u"&&(localStorage.removeItem("pending_email"),localStorage.removeItem("pending_user_id"))},v=async s=>{try{if(!s)return!1;const{data:n,error:c}=await p.from("users").select("email_verified").eq("email",s.toLowerCase()).maybeSingle();return c||!n?(console.error("Error checking email_verified:",c),!1):n.email_verified===!0}catch(n){return console.error("Exception checking email_verified:",n),!1}},B=async s=>{try{const{error:n}=await p.from("users").update({email_verified:!0,updated_at:new Date().toISOString()}).eq("email",s.toLowerCase());return n?(console.error("Error updating email_verified:",n),!1):!0}catch(n){return console.error("Exception updating email_verified:",n),!1}},G=async()=>{try{const{data:{session:s},error:n}=await p.auth.getSession();return n?(console.error("Error getting session:",n),!1):s?.user?.email_confirmed_at!==null}catch(s){return console.error("Exception checking auth confirmation:",s),!1}},q=async s=>{try{a("processing"),o("Processing email verification..."),h(30);const n=await G();h(60);const c=await v(s);if(h(80),D({confirmedInAuth:n,verifiedInDB:c}),n)if(await B(s)){const P=await v(s);h(100),P?(g(!0),a("verified"),o("Email verification completed successfully!"),x()):(g(!1),a("error"),o("Verification completed but database update failed."))}else g(!1),a("error"),o("Failed to update verification status.");else g(!1),a("not_verified"),o("Email verification link clicked, but confirmation is still pending.")}catch(n){console.error("Error processing email verification:",n),a("error"),o("An error occurred while processing email verification.")}};f.useEffect(()=>{const s=async()=>{try{const c=u.state?.email||F();if(!c){a("error"),o("No email found. Please try registering again.");return}m(c);const y=window.location.hash;if(y.includes("type=signup")||y.includes("token="))await q(c);else{a("loading"),o("Checking verification status..."),h(50);const X=await v(c);h(100),X?(g(!0),a("verified"),o("Your email is already verified!"),x()):(g(!1),a("not_verified"),o("Email not verified yet."))}}catch(c){console.error("Callback error:",c),a("error"),o("Something went wrong. Please try again.")}},n=setTimeout(()=>{s()},1e3);return()=>clearTimeout(n)},[u]);const N=async()=>{if(l){a("loading"),o("Checking verification status..."),h(50);try{const s=await v(l);h(100),s?(g(!0),a("verified"),o("Email verified successfully!"),x()):(g(!1),a("not_verified"),o("Email not verified yet."))}catch{a("error"),o("Failed to check verification status")}}},O=async()=>{if(l){a("loading"),o("Sending verification email...");try{const{error:s}=await p.auth.resend({type:"signup",email:l,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});if(s)throw s;a("not_verified"),o(`Verification email sent to ${l}. Please check your inbox.`)}catch(s){console.error("Error resending verification:",s),a("error"),o("Failed to resend verification email")}}},H=()=>{x(),t("/login",{state:{email:l,verified:r==="verified",message:r==="verified"?"Email verified successfully! You can now log in.":void 0}})};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 px-4 py-8",children:e.jsx(U,{className:"w-full max-w-lg p-8 shadow-2xl border-0 bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-lg",children:e.jsx(ee,{className:"h-8 w-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent dark:from-blue-400 dark:to-indigo-400",children:"Email Verification"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:l&&`Verifying: ${l}`})]}),e.jsx(re,{className:"w-full"}),e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[(r==="loading"||r==="processing")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Processing..."}),e.jsxs("span",{className:"font-medium",children:[_,"%"]})]}),e.jsx(ke,{value:_,className:"h-2"})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:`relative ${r==="processing"||r==="loading"?"animate-pulse":""}`,children:[e.jsx("div",{className:`h-24 w-24 rounded-full flex items-center justify-center shadow-lg ${r==="verified"?"bg-gradient-to-br from-green-100 to-emerald-100 border-4 border-green-200 dark:from-green-900/30 dark:to-emerald-900/30 dark:border-green-800":r==="not_verified"?"bg-gradient-to-br from-amber-100 to-orange-100 border-4 border-amber-200 dark:from-amber-900/30 dark:to-orange-900/30 dark:border-amber-800":r==="error"?"bg-gradient-to-br from-red-100 to-rose-100 border-4 border-red-200 dark:from-red-900/30 dark:to-rose-900/30 dark:border-red-800":"bg-gradient-to-br from-blue-100 to-indigo-100 border-4 border-blue-200 dark:from-blue-900/30 dark:to-indigo-900/30 dark:border-blue-800"}`,children:r==="loading"||r==="processing"?e.jsx(V,{className:"h-12 w-12 text-blue-600 dark:text-blue-400 animate-spin"}):r==="verified"?e.jsx(de,{className:"h-12 w-12 text-green-600 dark:text-green-400"}):r==="not_verified"?e.jsx(se,{className:"h-12 w-12 text-amber-600 dark:text-amber-400"}):e.jsx(te,{className:"h-12 w-12 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2",children:e.jsxs(ae,{variant:r==="verified"?"default":r==="not_verified"?"secondary":r==="error"?"destructive":"outline",className:"px-3 py-1 font-medium",children:[r==="loading"&&"Checking",r==="processing"&&"Processing",r==="verified"&&"Verified",r==="not_verified"&&"Not Verified",r==="error"&&"Error"]})})]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[r==="loading"&&"Checking Verification Status",r==="processing"&&"Processing Verification",r==="verified"&&"Email Verified Successfully!",r==="not_verified"&&"Email Verification Required",r==="error"&&"Verification Failed"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed",children:k})]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[r==="verified"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:H,className:"w-full h-12 text-base font-medium bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-lg",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Continue to Login"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{onClick:N,variant:"outline",className:"flex-1",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Check Again"]}),e.jsx(d,{onClick:()=>t("/"),variant:"ghost",className:"flex-1",children:"Go Home"})]})]}),r==="not_verified"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:O,className:"w-full h-12 text-base font-medium bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-lg",children:[e.jsx(le,{className:"h-5 w-5 mr-2"}),"Resend Verification Email"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{onClick:N,variant:"outline",className:"flex-1",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Check Status"]}),e.jsx(d,{onClick:()=>t("/login"),variant:"ghost",className:"flex-1",children:"Go to Login"})]})]}),r==="error"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{onClick:N,className:"w-full h-12 text-base font-medium",children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),"Try Again"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:()=>t("/register"),variant:"outline",className:"flex-1",children:"Register Again"}),e.jsx(d,{onClick:()=>t("/"),variant:"ghost",className:"flex-1",children:"Go Home"})]})]}),r==="processing"&&e.jsxs(d,{disabled:!0,className:"w-full h-12",children:[e.jsx(V,{className:"h-5 w-5 mr-2 animate-spin"}),"Processing Verification..."]})]}),e.jsx("div",{className:"pt-6 border-t",children:e.jsxs(Z,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-600"}),e.jsx(J,{className:"text-blue-800 dark:text-blue-300",children:"Need help?"}),e.jsx(Q,{className:"text-blue-700 dark:text-blue-400 text-sm",children:e.jsxs("ul",{className:"space-y-1 mt-1",children:[e.jsx("li",{children:"• Check your spam folder for the verification email"}),e.jsx("li",{children:"• Make sure you clicked the link in the verification email"}),e.jsx("li",{children:"• Verification links expire after 24 hours"})]})})]})})]})]})})})});export{Ie as default};
