import{a as o,p as r,w as qe,v as Ue,y as se}from"./chunk-EPOLDU6W-BHelFxtI.js";import{c as be,u as Ne,B as Y}from"./card-DCCwVGqU.js";import{u as We,c as V,P as je,A as Be,L as D,I as G,E as pe,a as xe,t as _}from"./AuthChecker-lr5Qdb8c.js";import{A as Ye,r as Ze,C as Xe,a as he}from"./AuthLayout-_UhsZK27.js";import{A as ge,a as ye}from"./alert-9_S9W-Db.js";import{c as ke,u as Je,R as Ke,A as Qe,P as er,a as rr,D as tr,C as sr}from"./index-BMxA-PKL.js";import"./index-BRs_dBEV.js";import{c as Z,a as ar,L as ae}from"./loader-circle-B5kmy_fB.js";import{s as R}from"./supabase-BO81Wobz.js";import{T as ir,M as or,C as I,a as we}from"./triangle-alert-CiF5QaMf.js";import"./ThemeProvider-1bH72AO7.js";const nr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],lr=Z("info",nr);const cr=[["path",{d:"M22 10.5V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h12.5",key:"e61zoh"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"M20 14v4",key:"1hm744"}],["path",{d:"M20 22v.01",key:"12bgn6"}]],dr=Z("mail-warning",cr);const mr=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ur=Z("shield-alert",mr);const fr=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ve=Z("user-x",fr);function pr(t,s=[]){let e=[];function i(c,l){const m=o.createContext(l),n=e.length;e=[...e,l];const p=x=>{const{scope:b,children:g,...j}=x,k=b?.[t]?.[n]||m,h=o.useMemo(()=>j,Object.values(j));return r.jsx(k.Provider,{value:h,children:g})};p.displayName=c+"Provider";function u(x,b){const g=b?.[t]?.[n]||m,j=o.useContext(g);if(j)return j;if(l!==void 0)return l;throw new Error(`\`${x}\` must be used within \`${c}\``)}return[p,u]}const a=()=>{const c=e.map(l=>o.createContext(l));return function(m){const n=m?.[t]||c;return o.useMemo(()=>({[`__scope${t}`]:{...m,[t]:n}}),[m,n])}};return a.scopeName=t,[i,xr(a,...s)]}function xr(...t){const s=t[0];if(t.length===1)return s;const e=()=>{const i=t.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(c){const l=i.reduce((m,{useScope:n,scopeName:p})=>{const x=n(c)[`__scope${p}`];return{...m,...x}},{});return o.useMemo(()=>({[`__scope${s.scopeName}`]:l}),[l])}};return e.scopeName=s.scopeName,e}function hr(t){const s=gr(t),e=o.forwardRef((i,a)=>{const{children:c,...l}=i,m=o.Children.toArray(c),n=m.find(wr);if(n){const p=n.props.children,u=m.map(x=>x===n?o.Children.count(p)>1?o.Children.only(null):o.isValidElement(p)?p.props.children:null:x);return r.jsx(s,{...l,ref:a,children:o.isValidElement(p)?o.cloneElement(p,void 0,u):null})}return r.jsx(s,{...l,ref:a,children:c})});return e.displayName=`${t}.Slot`,e}function gr(t){const s=o.forwardRef((e,i)=>{const{children:a,...c}=e;if(o.isValidElement(a)){const l=br(a),m=vr(c,a.props);return a.type!==o.Fragment&&(m.ref=i?be(i,l):l),o.cloneElement(a,m)}return o.Children.count(a)>1?o.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var Ce=Symbol("radix.slottable");function yr(t){const s=({children:e})=>r.jsx(r.Fragment,{children:e});return s.displayName=`${t}.Slottable`,s.__radixId=Ce,s}function wr(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ce}function vr(t,s){const e={...s};for(const i in s){const a=t[i],c=s[i];/^on[A-Z]/.test(i)?a&&c?e[i]=(...m)=>{const n=c(...m);return a(...m),n}:a&&(e[i]=a):i==="style"?e[i]={...a,...c}:i==="className"&&(e[i]=[a,c].filter(Boolean).join(" "))}return{...t,...e}}function br(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,e=s&&"isReactWarning"in s&&s.isReactWarning;return e?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,e=s&&"isReactWarning"in s&&s.isReactWarning,e?t.props.ref:t.props.ref||t.ref)}var Nr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],jr=Nr.reduce((t,s)=>{const e=hr(`Primitive.${s}`),i=o.forwardRef((a,c)=>{const{asChild:l,...m}=a,n=l?e:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),r.jsx(n,{...m,ref:c})});return i.displayName=`Primitive.${s}`,{...t,[s]:i}},{});function kr(t){const s=Cr(t),e=o.forwardRef((i,a)=>{const{children:c,...l}=i,m=o.Children.toArray(c),n=m.find(_r);if(n){const p=n.props.children,u=m.map(x=>x===n?o.Children.count(p)>1?o.Children.only(null):o.isValidElement(p)?p.props.children:null:x);return r.jsx(s,{...l,ref:a,children:o.isValidElement(p)?o.cloneElement(p,void 0,u):null})}return r.jsx(s,{...l,ref:a,children:c})});return e.displayName=`${t}.Slot`,e}function Cr(t){const s=o.forwardRef((e,i)=>{const{children:a,...c}=e;if(o.isValidElement(a)){const l=Tr(a),m=Er(c,a.props);return a.type!==o.Fragment&&(m.ref=i?be(i,l):l),o.cloneElement(a,m)}return o.Children.count(a)>1?o.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var Pr=Symbol("radix.slottable");function _r(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Pr}function Er(t,s){const e={...s};for(const i in s){const a=t[i],c=s[i];/^on[A-Z]/.test(i)?a&&c?e[i]=(...m)=>{const n=c(...m);return a(...m),n}:a&&(e[i]=a):i==="style"?e[i]={...a,...c}:i==="className"&&(e[i]=[a,c].filter(Boolean).join(" "))}return{...t,...e}}function Tr(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,e=s&&"isReactWarning"in s&&s.isReactWarning;return e?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,e=s&&"isReactWarning"in s&&s.isReactWarning,e?t.props.ref:t.props.ref||t.ref)}var Sr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Rr=Sr.reduce((t,s)=>{const e=kr(`Primitive.${s}`),i=o.forwardRef((a,c)=>{const{asChild:l,...m}=a,n=l?e:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),r.jsx(n,{...m,ref:c})});return i.displayName=`Primitive.${s}`,{...t,[s]:i}},{}),Ar=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Dr="VisuallyHidden",Pe=o.forwardRef((t,s)=>r.jsx(Rr.span,{...t,ref:s,style:{...Ar,...t.style}}));Pe.displayName=Dr;var Ir=Pe,[X]=pr("Tooltip",[ke]),J=ke(),_e="TooltipProvider",Or=700,ie="tooltip.open",[$r,ne]=X(_e),Ee=t=>{const{__scopeTooltip:s,delayDuration:e=Or,skipDelayDuration:i=300,disableHoverableContent:a=!1,children:c}=t,l=o.useRef(!0),m=o.useRef(!1),n=o.useRef(0);return o.useEffect(()=>{const p=n.current;return()=>window.clearTimeout(p)},[]),r.jsx($r,{scope:s,isOpenDelayedRef:l,delayDuration:e,onOpen:o.useCallback(()=>{window.clearTimeout(n.current),l.current=!1},[]),onClose:o.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(()=>l.current=!0,i)},[i]),isPointerInTransitRef:m,onPointerInTransitChange:o.useCallback(p=>{m.current=p},[]),disableHoverableContent:a,children:c})};Ee.displayName=_e;var q="Tooltip",[Lr,U]=X(q),Te=t=>{const{__scopeTooltip:s,children:e,open:i,defaultOpen:a,onOpenChange:c,disableHoverableContent:l,delayDuration:m}=t,n=ne(q,t.__scopeTooltip),p=J(s),[u,x]=o.useState(null),b=Je(),g=o.useRef(0),j=l??n.disableHoverableContent,k=m??n.delayDuration,h=o.useRef(!1),[C,P]=We({prop:i,defaultProp:a??!1,onChange:K=>{K?(n.onOpen(),document.dispatchEvent(new CustomEvent(ie))):n.onClose(),c?.(K)},caller:q}),E=o.useMemo(()=>C?h.current?"delayed-open":"instant-open":"closed",[C]),$=o.useCallback(()=>{window.clearTimeout(g.current),g.current=0,h.current=!1,P(!0)},[P]),L=o.useCallback(()=>{window.clearTimeout(g.current),g.current=0,P(!1)},[P]),W=o.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>{h.current=!0,P(!0),g.current=0},k)},[k,P]);return o.useEffect(()=>()=>{g.current&&(window.clearTimeout(g.current),g.current=0)},[]),r.jsx(Ke,{...p,children:r.jsx(Lr,{scope:s,contentId:b,open:C,stateAttribute:E,trigger:u,onTriggerChange:x,onTriggerEnter:o.useCallback(()=>{n.isOpenDelayedRef.current?W():$()},[n.isOpenDelayedRef,W,$]),onTriggerLeave:o.useCallback(()=>{j?L():(window.clearTimeout(g.current),g.current=0)},[L,j]),onOpen:$,onClose:L,disableHoverableContent:j,children:e})})};Te.displayName=q;var oe="TooltipTrigger",Se=o.forwardRef((t,s)=>{const{__scopeTooltip:e,...i}=t,a=U(oe,e),c=ne(oe,e),l=J(e),m=o.useRef(null),n=Ne(s,m,a.onTriggerChange),p=o.useRef(!1),u=o.useRef(!1),x=o.useCallback(()=>p.current=!1,[]);return o.useEffect(()=>()=>document.removeEventListener("pointerup",x),[x]),r.jsx(Qe,{asChild:!0,...l,children:r.jsx(jr.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...i,ref:n,onPointerMove:V(t.onPointerMove,b=>{b.pointerType!=="touch"&&!u.current&&!c.isPointerInTransitRef.current&&(a.onTriggerEnter(),u.current=!0)}),onPointerLeave:V(t.onPointerLeave,()=>{a.onTriggerLeave(),u.current=!1}),onPointerDown:V(t.onPointerDown,()=>{a.open&&a.onClose(),p.current=!0,document.addEventListener("pointerup",x,{once:!0})}),onFocus:V(t.onFocus,()=>{p.current||a.onOpen()}),onBlur:V(t.onBlur,a.onClose),onClick:V(t.onClick,a.onClose)})})});Se.displayName=oe;var le="TooltipPortal",[Mr,Vr]=X(le,{forceMount:void 0}),Re=t=>{const{__scopeTooltip:s,forceMount:e,children:i,container:a}=t,c=U(le,s);return r.jsx(Mr,{scope:s,forceMount:e,children:r.jsx(je,{present:e||c.open,children:r.jsx(er,{asChild:!0,container:a,children:i})})})};Re.displayName=le;var F="TooltipContent",Ae=o.forwardRef((t,s)=>{const e=Vr(F,t.__scopeTooltip),{forceMount:i=e.forceMount,side:a="top",...c}=t,l=U(F,t.__scopeTooltip);return r.jsx(je,{present:i||l.open,children:l.disableHoverableContent?r.jsx(De,{side:a,...c,ref:s}):r.jsx(Fr,{side:a,...c,ref:s})})}),Fr=o.forwardRef((t,s)=>{const e=U(F,t.__scopeTooltip),i=ne(F,t.__scopeTooltip),a=o.useRef(null),c=Ne(s,a),[l,m]=o.useState(null),{trigger:n,onClose:p}=e,u=a.current,{onPointerInTransitChange:x}=i,b=o.useCallback(()=>{m(null),x(!1)},[x]),g=o.useCallback((j,k)=>{const h=j.currentTarget,C={x:j.clientX,y:j.clientY},P=qr(C,h.getBoundingClientRect()),E=Ur(C,P),$=Wr(k.getBoundingClientRect()),L=Yr([...E,...$]);m(L),x(!0)},[x]);return o.useEffect(()=>()=>b(),[b]),o.useEffect(()=>{if(n&&u){const j=h=>g(h,u),k=h=>g(h,n);return n.addEventListener("pointerleave",j),u.addEventListener("pointerleave",k),()=>{n.removeEventListener("pointerleave",j),u.removeEventListener("pointerleave",k)}}},[n,u,g,b]),o.useEffect(()=>{if(l){const j=k=>{const h=k.target,C={x:k.clientX,y:k.clientY},P=n?.contains(h)||u?.contains(h),E=!Br(C,l);P?b():E&&(b(),p())};return document.addEventListener("pointermove",j),()=>document.removeEventListener("pointermove",j)}},[n,u,l,p,b]),r.jsx(De,{...t,ref:c})}),[Hr,zr]=X(q,{isInside:!1}),Gr=yr("TooltipContent"),De=o.forwardRef((t,s)=>{const{__scopeTooltip:e,children:i,"aria-label":a,onEscapeKeyDown:c,onPointerDownOutside:l,...m}=t,n=U(F,e),p=J(e),{onClose:u}=n;return o.useEffect(()=>(document.addEventListener(ie,u),()=>document.removeEventListener(ie,u)),[u]),o.useEffect(()=>{if(n.trigger){const x=b=>{b.target?.contains(n.trigger)&&u()};return window.addEventListener("scroll",x,{capture:!0}),()=>window.removeEventListener("scroll",x,{capture:!0})}},[n.trigger,u]),r.jsx(tr,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:x=>x.preventDefault(),onDismiss:u,children:r.jsxs(sr,{"data-state":n.stateAttribute,...p,...m,ref:s,style:{...m.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[r.jsx(Gr,{children:i}),r.jsx(Hr,{scope:e,isInside:!0,children:r.jsx(Ir,{id:n.contentId,role:"tooltip",children:a||i})})]})})});Ae.displayName=F;var Ie="TooltipArrow",Oe=o.forwardRef((t,s)=>{const{__scopeTooltip:e,...i}=t,a=J(e);return zr(Ie,e).isInside?null:r.jsx(rr,{...a,...i,ref:s})});Oe.displayName=Ie;function qr(t,s){const e=Math.abs(s.top-t.y),i=Math.abs(s.bottom-t.y),a=Math.abs(s.right-t.x),c=Math.abs(s.left-t.x);switch(Math.min(e,i,a,c)){case c:return"left";case a:return"right";case e:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function Ur(t,s,e=5){const i=[];switch(s){case"top":i.push({x:t.x-e,y:t.y+e},{x:t.x+e,y:t.y+e});break;case"bottom":i.push({x:t.x-e,y:t.y-e},{x:t.x+e,y:t.y-e});break;case"left":i.push({x:t.x+e,y:t.y-e},{x:t.x+e,y:t.y+e});break;case"right":i.push({x:t.x-e,y:t.y-e},{x:t.x-e,y:t.y+e});break}return i}function Wr(t){const{top:s,right:e,bottom:i,left:a}=t;return[{x:a,y:s},{x:e,y:s},{x:e,y:i},{x:a,y:i}]}function Br(t,s){const{x:e,y:i}=t;let a=!1;for(let c=0,l=s.length-1;c<s.length;l=c++){const m=s[c],n=s[l],p=m.x,u=m.y,x=n.x,b=n.y;u>i!=b>i&&e<(x-p)*(i-u)/(b-u)+p&&(a=!a)}return a}function Yr(t){const s=t.slice();return s.sort((e,i)=>e.x<i.x?-1:e.x>i.x?1:e.y<i.y?-1:e.y>i.y?1:0),Zr(s)}function Zr(t){if(t.length<=1)return t.slice();const s=[];for(let i=0;i<t.length;i++){const a=t[i];for(;s.length>=2;){const c=s[s.length-1],l=s[s.length-2];if((c.x-l.x)*(a.y-l.y)>=(c.y-l.y)*(a.x-l.x))s.pop();else break}s.push(a)}s.pop();const e=[];for(let i=t.length-1;i>=0;i--){const a=t[i];for(;e.length>=2;){const c=e[e.length-1],l=e[e.length-2];if((c.x-l.x)*(a.y-l.y)>=(c.y-l.y)*(a.x-l.x))e.pop();else break}e.push(a)}return e.pop(),s.length===1&&e.length===1&&s[0].x===e[0].x&&s[0].y===e[0].y?s:s.concat(e)}var Xr=Ee,Jr=Te,Kr=Se,Qr=Re,et=Ae,rt=Oe;function $e({delayDuration:t=0,...s}){return r.jsx(Xr,{"data-slot":"tooltip-provider",delayDuration:t,...s})}function tt({...t}){return r.jsx($e,{children:r.jsx(Jr,{"data-slot":"tooltip",...t})})}function st({...t}){return r.jsx(Kr,{"data-slot":"tooltip-trigger",...t})}function at({className:t,sideOffset:s=0,children:e,...i}){return r.jsx(Qr,{children:r.jsxs(et,{"data-slot":"tooltip-content",sideOffset:s,className:ar("bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[e,r.jsx(rt,{className:"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}const O=new Map,it=300*1e3,gt=qe(function(){const s=Ue(),[e,i]=o.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",terms:!1,newsletter:!1}),[a,c]=o.useState(!1),[l,m]=o.useState(!1),[n,p]=o.useState({}),[u,x]=o.useState(!1),[b,g]=o.useState(!1),[j,k]=o.useState([]),[h,C]=o.useState({exists:!1,email_verified:null}),[P,E]=o.useState(!1),[$,L]=o.useState(!0),W=["tempmail.com","10minutemail.com","guerrillamail.com","mailinator.com","yopmail.com","throwawaymail.com","fakeinbox.com","temp-mail.org","trashmail.com","dispostable.com","getairmail.com","maildrop.cc","tempmailaddress.com","fake-mail.com","mytemp.email","tempemail.net"],Q=(d=>{let f=0;return d.length>=8&&(f+=1),d.length>=12&&(f+=1),/[A-Z]/.test(d)&&(f+=1),/[a-z]/.test(d)&&(f+=1),/[0-9]/.test(d)&&(f+=1),/[^A-Za-z0-9]/.test(d)&&(f+=1),f<=2?"weak":f<=4?"medium":f<=5?"strong":"very-strong"})(e.password),Le={length:e.password.length>=8,uppercase:/[A-Z]/.test(e.password),lowercase:/[a-z]/.test(e.password),number:/[0-9]/.test(e.password),special:/[^A-Za-z0-9]/.test(e.password)},B=e.password===e.confirmPassword&&e.password.length>0,ce={weak:{color:"bg-red-500",text:"Weak"},medium:{color:"bg-yellow-500",text:"Medium"},strong:{color:"bg-green-500",text:"Strong"},"very-strong":{color:"bg-emerald-600",text:"Very Strong"}},ee=o.useCallback(async d=>{const f=d.toLowerCase().trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f))return C({exists:!1,email_verified:null}),{exists:!1,email_verified:null};const w=O.get(f);if(w&&Date.now()-w.timestamp<it)return C({exists:w.exists,email_verified:w.email_verified,user_id:w.user_id}),{exists:w.exists,email_verified:w.email_verified,user_id:w.user_id};g(!0);try{const{data:N,error:v}=await R.from("users").select("id, email, email_verified").eq("email",f).maybeSingle();if(v){console.error("Database query error:",v);const S={exists:!1,email_verified:null};return O.set(f,{exists:!1,email_verified:!1,timestamp:Date.now()}),C(S),S}const{data:T,error:M}=await R.auth.admin.listUsers();M&&console.error("Auth users query error:",M);const A=T?.users?.find(S=>S.email?.toLowerCase()===f),Ge=A?.identities?.some(S=>S.provider==="google");let re=!!N||!!A,te=N?.email_verified||!1;const me=N?.id||A?.id;Ge&&!N&&(re=!0,te=!0);const ue={exists:re,email_verified:te,user_id:me};return O.set(f,{exists:re,email_verified:te,user_id:me,timestamp:Date.now()}),C(ue),p(S=>{const fe={...S};return delete fe.email,fe}),ue}catch(N){console.error("Error checking email:",N);const v={exists:!1,email_verified:null};return O.set(f,{exists:!1,email_verified:!1,timestamp:Date.now()}),C(v),v}finally{g(!1)}},[]),de=d=>{const f=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!d.trim())return{isValid:!1,message:"Email is required"};if(!f.test(d))return{isValid:!1,message:"Please enter a valid email address"};const y=d.split("@")[1];return y&&W.some(w=>y.toLowerCase().includes(w.toLowerCase()))?{isValid:!1,message:"Please use a permanent email address"}:{isValid:!0}},H=o.useRef(),z=d=>{const{id:f,value:y,type:w,checked:N}=d.target;if(f==="email"&&(C({exists:!1,email_verified:null}),O.delete(y.toLowerCase())),i(v=>({...v,[f]:w==="checkbox"?N:y})),f==="email"){const{isValid:v,message:T}=de(y);!v&&T?(p(M=>({...M,email:T})),k([])):n.email&&(p(M=>{const A={...M};return delete A.email,delete A.submit,A}),k([])),H.current&&clearTimeout(H.current),v&&(H.current=setTimeout(()=>{ee(y)},800))}else n[f]&&p(v=>{const T={...v};return delete T[f],T})};o.useEffect(()=>{document.title="DeskStaff - Register"},[]),o.useEffect(()=>()=>{H.current&&clearTimeout(H.current)},[]);const Me=async()=>{E(!0),p({});try{const d=e.email.toLowerCase();if(e.email){const{exists:w,email_verified:N}=await ee(d);if(w)if(N===!0){_.error("This email is already registered. Please log in instead."),E(!1);return}else{_.error("This email is registered but not verified. Please check your email or use the resend verification option above."),E(!1);return}}localStorage.setItem("google_signup_flow","true");const f=window.location.origin,{error:y}=await R.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${f}/auth/google`,queryParams:{access_type:"offline",prompt:"consent"}}});if(y)throw console.error("Google OAuth error:",y),new Error(`Google sign up failed: ${y.message}`)}catch(d){console.error("Google sign up error:",d),d instanceof Error?_.error(d.message):_.error("Google sign up failed. Please try again."),E(!1)}},Ve=()=>{const d={};e.firstName.trim()||(d.firstName="First name is required"),e.lastName.trim()||(d.lastName="Last name is required");const f=de(e.email);return!f.isValid&&f.message&&(d.email=f.message),!d.email&&h.exists&&(h.email_verified===!0?d.email="This email is already registered and verified. Please use a different email or try logging in.":h.email_verified===!1&&(d.email="This email is registered but not verified. Please check your email for the verification link or click below to resend.")),e.password?e.password.length<8?d.password="Password must be at least 8 characters":Q==="weak"&&(d.password="Please use a stronger password"):d.password="Password is required",e.confirmPassword?B||(d.confirmPassword="Passwords do not match"):d.confirmPassword="Please confirm your password",e.terms||(d.terms="You must agree to the terms and privacy policy"),p(d),Object.keys(d).length===0},Fe=async d=>{if(d.preventDefault(),!Ve())return;const f=e.email.toLowerCase();try{const{exists:y,email_verified:w,user_id:N}=await ee(f);if(y){if(w===!0){_.error("This email is already registered and verified. Please use a different email or try logging in.");return}else if(w===!1){typeof window<"u"&&N&&(localStorage.setItem("pending_email",e.email),localStorage.setItem("pending_user_id",N)),s("/auth/callback",{state:{email:e.email,userId:N,message:"Your email is registered but not verified. Please verify your email to continue."}});return}}}catch(y){console.error("Final email check error:",y)}x(!0),p({});try{const y=window.location.origin,{data:w,error:N}=await R.auth.signUp({email:f,password:e.password,options:{data:{first_name:e.firstName.trim(),last_name:e.lastName.trim(),full_name:`${e.firstName.trim()} ${e.lastName.trim()}`,newsletter_subscribed:e.newsletter},emailRedirectTo:`${y}/auth/callback`}});if(N)throw console.error("Supabase auth error:",N),N.message.includes("User already registered")?(O.set(f,{exists:!0,email_verified:null,timestamp:Date.now()}),C({exists:!0,email_verified:null}),new Error("This email is already registered. Please use a different email or try logging in.")):N.message.includes("Password should be at least")?new Error("Password is too weak. Please use a stronger password."):N.message.includes("Invalid email")?new Error("Please enter a valid email address."):N.message.includes("rate limit")?new Error("Too many attempts. Please try again in a few minutes."):new Error(`Registration failed: ${N.message}`);if(!w.user)throw new Error("Registration failed. Please try again.");try{const{error:v}=await R.from("users").insert({id:w.user.id,email:f,first_name:e.firstName.trim(),last_name:e.lastName.trim(),full_name:`${e.firstName.trim()} ${e.lastName.trim()}`,newsletter_subscribed:e.newsletter,email_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(v){if(console.error("Error inserting user into users table:",v),v.code==="23505"){const{error:T}=await R.from("users").update({first_name:e.firstName.trim(),last_name:e.lastName.trim(),full_name:`${e.firstName.trim()} ${e.lastName.trim()}`,newsletter_subscribed:e.newsletter,email_verified:!1,updated_at:new Date().toISOString()}).eq("email",f);T&&console.error("Error updating user in users table:",T)}}else console.log("✅ User successfully added to users table with email_verified = false")}catch(v){console.error("Database insert/update error:",v)}try{const{data:v}=await R.from("users").select("email_verified").eq("email",f).maybeSingle();v?console.log("User verification status:",v.email_verified):console.warn("User was not added to users table")}catch(v){console.error("Error verifying user status:",v)}typeof window<"u"&&(localStorage.setItem("pending_email",e.email),localStorage.setItem("pending_user_id",w.user.id)),O.set(f,{exists:!0,email_verified:!1,user_id:w.user.id,timestamp:Date.now()}),_.success("Registration successful! Please check your email to verify your account."),s("/auth/callback",{state:{email:e.email,userId:w.user.id,message:"Registration successful! Please check your email to verify your account."}})}catch(y){console.error("Registration error:",y),y instanceof Error?_.error(y.message):_.error("Registration failed. Please try again.")}finally{x(!1)}},He=async()=>{if(e.email){x(!0),p({});try{const{error:d}=await R.auth.resend({type:"signup",email:e.email,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});if(d)throw d;typeof window<"u"&&localStorage.setItem("pending_email",e.email),_.success("Verification email resent! Please check your inbox."),s("/auth/callback",{state:{email:e.email,message:"Verification email resent! Please check your inbox."}})}catch(d){console.error("Error resending verification:",d),_.error("Failed to resend verification email. Please try again.")}}},ze=e.terms&&B&&e.password.length>=8&&!n.email&&!h.exists&&e.email.includes("@");return r.jsx(Be,{requireAuth:!1,redirectTo:"/profile/:userId",children:r.jsx(Ye,{illustration:Ze,illustrationAlt:"Registration illustration",gradientFrom:"from-blue-50",gradientTo:"to-indigo-100",children:r.jsxs("div",{className:"w-full max-w-md",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-2xl font-semibold tracking-tight dark:text-white",children:"Create an Account"}),r.jsx("p",{className:"text-sm text-muted-foreground dark:text-gray-400",children:"Join us today! Please enter your details."})]}),n.submit&&r.jsxs(ge,{variant:"destructive",className:"mb-6",children:[r.jsx(Xe,{className:"h-4 w-4"}),r.jsx(ye,{children:n.submit})]}),h.exists&&h.email_verified===!1&&r.jsxs(ge,{className:"mb-6 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:[r.jsx(ir,{className:"h-4 w-4 text-amber-600"}),r.jsx(ye,{className:"text-amber-800 dark:text-amber-300",children:r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("p",{children:"This email is registered but not verified."}),r.jsxs(Y,{onClick:He,size:"sm",variant:"outline",className:"mt-2 border-amber-300 text-amber-700 hover:bg-amber-100 dark:border-amber-700 dark:text-amber-300 dark:hover:bg-amber-900/30",children:[r.jsx(or,{className:"h-4 w-4 mr-2"}),"Resend Verification Email"]})]})})]}),r.jsxs("form",{onSubmit:Fe,className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(D,{htmlFor:"firstName",className:"dark:text-gray-300",children:"First Name"}),r.jsx(G,{id:"firstName",type:"text",placeholder:"John",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${n.firstName?"border-red-500 dark:border-red-500":""}`,value:e.firstName,onChange:z,disabled:u,required:!0}),n.firstName&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.firstName]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(D,{htmlFor:"lastName",className:"dark:text-gray-300",children:"Last Name"}),r.jsx(G,{id:"lastName",type:"text",placeholder:"Doe",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 ${n.lastName?"border-red-500 dark:border-red-500":""}`,value:e.lastName,onChange:z,disabled:u,required:!0}),n.lastName&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.lastName]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs(D,{htmlFor:"email",className:"dark:text-gray-300",children:["Email Address",r.jsx($e,{children:r.jsxs(tt,{children:[r.jsx(st,{asChild:!0,children:r.jsx("button",{type:"button",className:"ml-2",children:r.jsx(lr,{className:"h-3 w-3 text-muted-foreground"})})}),r.jsx(at,{children:r.jsx("p",{className:"text-xs",children:"Use a permanent email you have access to"})})]})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[b&&r.jsx(ae,{className:"h-3 w-3 animate-spin text-gray-500"}),h.exists&&!b&&e.email.includes("@")&&r.jsx("div",{className:"flex items-center gap-1 text-xs",children:h.email_verified===!0?r.jsxs(r.Fragment,{children:[r.jsx(ve,{className:"h-3 w-3 text-red-500"}),r.jsx("span",{className:"text-red-500",children:"✗ Email Already Exist"})]}):h.email_verified===!1?r.jsxs(r.Fragment,{children:[r.jsx(ur,{className:"h-3 w-3 text-amber-500"}),r.jsx("span",{className:"text-amber-500",children:"⚠️ Not Verified"})]}):r.jsxs(r.Fragment,{children:[r.jsx(ve,{className:"h-3 w-3 text-red-500"}),r.jsx("span",{className:"text-red-500",children:"Already Registered"})]})})]})]}),r.jsxs("div",{className:"relative",children:[r.jsx(G,{id:"email",type:"email",placeholder:"you@example.com",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 pr-10 ${n.email||h.exists?"border-red-500 dark:border-red-500":""}`,value:e.email,onChange:z,disabled:u,required:!0}),r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:n.email||h.exists?r.jsx(dr,{className:"h-4 w-4 text-red-500"}):e.email.includes("@")&&!n.email&&!h.exists?r.jsx(we,{className:"h-4 w-4 text-green-500"}):null})]}),n.email&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.email]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(D,{htmlFor:"password",className:"dark:text-gray-300",children:"Password"}),e.password&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`h-2 w-12 rounded-full ${ce[Q].color}`}),r.jsx("span",{className:"text-xs font-medium dark:text-gray-300",children:ce[Q].text})]})]}),r.jsxs("div",{className:"relative",children:[r.jsx(G,{id:"password",type:a?"text":"password",placeholder:"••••••••",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 pr-10 ${n.password?"border-red-500 dark:border-red-500":""}`,value:e.password,onChange:z,disabled:u,required:!0}),r.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 disabled:opacity-50",onClick:()=>c(!a),disabled:u,children:a?r.jsx(pe,{className:"h-4 w-4"}):r.jsx(xe,{className:"h-4 w-4"})})]}),n.password&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.password]}),r.jsxs("div",{className:"space-y-1 mt-2",children:[r.jsx("p",{className:"text-xs font-medium dark:text-gray-400",children:"Password must contain:"}),r.jsx("div",{className:"space-y-1",children:Object.entries(Le).map(([d,f])=>{const y={length:"At least 8 characters",uppercase:"One uppercase letter (A-Z)",lowercase:"One lowercase letter (a-z)",number:"One number (0-9)",special:"One special character (!@#$%^&*)"};return r.jsxs("div",{className:"flex items-center gap-2",children:[f?r.jsx(we,{className:"h-3 w-3 text-green-500"}):r.jsx(I,{className:"h-3 w-3 text-gray-400"}),r.jsx("span",{className:`text-xs ${f?"text-green-600 dark:text-green-500":"text-gray-500 dark:text-gray-400"}`,children:y[d]})]},d)})})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(D,{htmlFor:"confirmPassword",className:"dark:text-gray-300",children:"Confirm Password"}),e.confirmPassword&&r.jsx("span",{className:`text-xs font-medium ${B?"text-green-600 dark:text-green-500":"text-red-500"}`,children:B?"✓ Passwords match":"✗ Passwords don't match"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(G,{id:"confirmPassword",type:l?"text":"password",placeholder:"••••••••",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 pr-10 ${n.confirmPassword?"border-red-500 dark:border-red-500":""}`,value:e.confirmPassword,onChange:z,disabled:u,required:!0}),r.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 disabled:opacity-50",onClick:()=>m(!l),disabled:u,children:l?r.jsx(pe,{className:"h-4 w-4"}):r.jsx(xe,{className:"h-4 w-4"})})]}),n.confirmPassword&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.confirmPassword]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:`space-y-2 rounded-lg ${n.terms?"bg-red-50 dark:bg-red-900/20":""}`,children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"flex-0 items-center",children:r.jsx(he,{id:"terms",checked:e.terms,onCheckedChange:d=>i(f=>({...f,terms:d})),className:`mt-1 dark:border-gray-600 dark:data-[state=checked]:bg-primary ${n.terms?"border-red-500 dark:border-red-500":""}`,disabled:u})}),r.jsxs("div",{children:[r.jsxs(D,{htmlFor:"terms",className:"font-normal dark:text-gray-400",children:["I agree to the"," ",r.jsx(se,{to:"/terms",className:"text-primary hover:underline dark:text-primary-400",onClick:d=>u&&d.preventDefault(),children:"Terms"})," ","and"," ",r.jsx(se,{to:"/privacy",className:"text-primary hover:underline dark:text-primary-400",onClick:d=>u&&d.preventDefault(),children:"Privacy Policy"})]}),n.terms&&r.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[r.jsx(I,{className:"h-3 w-3"}),n.terms]})]})]})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(he,{id:"newsletter",checked:e.newsletter,onCheckedChange:d=>i(f=>({...f,newsletter:d})),className:"mt-1 dark:border-gray-600 dark:data-[state=checked]:bg-primary",disabled:u}),r.jsx(D,{htmlFor:"newsletter",className:"font-normal dark:text-gray-400",children:"Subscribe to newsletter for updates and offers"})]})]}),r.jsx(Y,{type:"submit",className:"w-full",size:"lg",disabled:u||!ze,children:u?r.jsxs(r.Fragment,{children:[r.jsx(ae,{className:"h-4 w-4 animate-spin mr-2"}),"Creating Account..."]}):"Create Account"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-border dark:border-gray-700"})}),r.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:r.jsx("span",{className:"bg-card dark:bg-gray-800 px-2 text-muted-foreground dark:text-gray-400",children:"Or continue with"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs(Y,{type:"button",variant:"outline",size:"lg",className:"w-full flex items-center gap-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",onClick:Me,disabled:u||P,children:[P?r.jsx(ae,{className:"h-5 w-5 animate-spin"}):r.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"Google",className:"h-5 w-5"}),P?"Signing in...":"Sign up with Google"]}),r.jsxs(Y,{type:"button",variant:"outline",size:"lg",className:"w-full flex items-center gap-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",disabled:u,onClick:()=>_.info("GitHub sign up coming soon!"),children:[r.jsx("img",{src:"https://www.svgrepo.com/show/475661/github-filled.svg",alt:"GitHub",className:"h-5 w-5"}),"Sign up with GitHub"]})]})]}),r.jsxs("p",{className:"mt-8 text-center text-sm text-muted-foreground dark:text-gray-400",children:["Already have an account?"," ",r.jsx(se,{to:"/",className:"text-primary font-medium hover:underline dark:text-primary-400",onClick:d=>u&&d.preventDefault(),children:"Sign in here"})]})]})})})});export{gt as default};
