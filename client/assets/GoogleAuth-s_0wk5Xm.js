import{w as p,v as w,z as x,a as n,p as e}from"./chunk-EPOLDU6W-BHelFxtI.js";import{s as t}from"./supabase-ABfmbsGw.js";import{A as _,a as v}from"./alert-9_S9W-Db.js";import{L as S}from"./loader-circle-B5kmy_fB.js";const C=p(function(){const s=w();x();const[l,c]=n.useState(""),[g,u]=n.useState(!0);return n.useEffect(()=>{(async()=>{try{const{data:{session:a},error:m}=await t.auth.getSession();if(m)throw new Error(`Auth error: ${m.message}`);if(!a?.user)throw new Error("No user session found");const r=a.user,o=r.email?.toLowerCase(),h=localStorage.getItem("google_signup_flow");if(localStorage.removeItem("google_signup_flow"),!o)throw new Error("No email found from Google");const{data:i,error:d}=await t.from("users").select("id, email, email_verified").eq("email",o).maybeSingle();if(d&&console.error("Error checking user:",d),i){i.email_verified||await t.from("users").update({email_verified:!0,updated_at:new Date().toISOString()}).eq("id",i.id),s("/profile/"+r.id,{replace:!0,state:{message:"Successfully logged in!"}});return}if(h==="true"){const{error:f}=await t.from("users").insert({id:r.id,email:o,first_name:r.user_metadata?.given_name||"",last_name:r.user_metadata?.family_name||"",full_name:r.user_metadata?.full_name||"",avatar_url:r.user_metadata?.avatar_url||"",email_verified:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});f&&console.error("Error inserting Google user:",f),s("/dashboard",{replace:!0,state:{message:"Registration successful!"}})}else await t.auth.signOut(),c("No account found with this Google email. Please register first."),u(!1)}catch(a){console.error("Callback error:",a),c(a instanceof Error?a.message:"An error occurred"),u(!1)}})()},[s]),g?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Processing Google sign in..."})]})}):l?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx(_,{variant:"destructive",children:e.jsx(v,{children:l})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>s("/register"),className:"text-primary hover:underline",children:"Go back to registration"})})]})}):null});export{C as default};
