import{w as Z,v as ee,z as ie,a as h,p as e}from"./chunk-EPOLDU6W-lxn-7cHT.js";import{L as b,a as g,C as se,s as V}from"./supabase-D95lysMu.js";import{c as F,C as ae,B as r}from"./card-D0Zu7Dju.js";import{M as E,E as A,R as T,T as U}from"./triangle-alert-DaEtPd0U.js";const te=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],O=F("log-in",te);const re=[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]],ne=F("mail-check",re);const ce=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],q=F("shield",ce),fe=Z(function(){const j=ee(),_=ie(),[d,t]=h.useState("loading"),[v,a]=h.useState(""),[l,H]=h.useState(""),[L,z]=h.useState(null),[oe,D]=h.useState(0),[$,W]=h.useState(5),M=3,X=()=>typeof window<"u"&&localStorage.getItem("pending_email")||"",J=()=>typeof window<"u"&&localStorage.getItem("pending_user_id")||null,m=()=>{typeof window<"u"&&(localStorage.removeItem("pending_email"),localStorage.removeItem("pending_user_id"))},p=async(s,c)=>{try{let i=V.from("users").select("email_verified, id, email").eq("email",s.toLowerCase());const{data:n,error:N}=await i.maybeSingle();if(N)return console.error("Error checking user verification:",N),{verified:!1,error:N.message};if(!n)return{verified:!1,error:"User not found in database"};const x=n.email_verified===!0,{data:{session:o},error:k}=await V.auth.getSession();if(k)return console.error("Session check error:",k),{verified:x,userId:n.id};const f=o?.user?.email_confirmed_at!==null||o?.user?.confirmed_at!==null;return{verified:x&&f,userId:n.id,dbVerified:x,authVerified:f}}catch(i){return console.error("Exception checking verification status:",i),{verified:!1,error:"Failed to check verification status"}}},w=async(s,c)=>{try{const{error:i}=await V.from("users").update({email_verified:c,updated_at:new Date().toISOString()}).eq("email",s.toLowerCase());return i?(console.error("Error updating user verification in DB:",i),!1):!0}catch(i){return console.error("Exception updating verification in DB:",i),!1}},Y=async(s,c,i)=>{if(i>=M){t("unverified"),a(`Email verification is taking longer than expected. Please check your email at ${s} and click the verification link. You may need to manually refresh this page after verifying.`);return}await new Promise(o=>setTimeout(o,3e3));const{verified:n,dbVerified:N,authVerified:x}=await p(s);n?(N||await w(s,!0),t("success"),a("Email verified successfully! Your account is now active."),m(),u()):(D(i+1),t("checking_verification"),a(`Still checking verification status... (Attempt ${i+1}/${M})`),setTimeout(()=>{Y(s,c,i+1)},3e3))},u=()=>{const s=setInterval(()=>{W(c=>c<=1?(clearInterval(s),j("/login",{state:{message:"Email verified successfully! You can now log in."}}),0):c-1)},1e3);return()=>clearInterval(s)},S=()=>{t("already_verified"),a("Your email is already verified! Redirecting to login..."),m(),u()};h.useEffect(()=>{const s=async()=>{try{const i=_.state?.email||X(),n=_.state?.userId||J();if(H(i),z(n),!i){t("error"),a("No email found. Please try registering again.");return}if((await p(i,n)).verified){S();return}const x=window.location.hash;if(x.includes("type=signup")||x.includes("token=")){t("checking_verification"),a("Verifying your email... Please wait.");const{error:o}=await V.auth.getSession();if(o){console.error("Session error after email verification:",o),t("error"),a("Email verification failed. Please try again.");return}const{verified:k,dbVerified:f,authVerified:y,error:C}=await p(i,n);C&&C!=="User not found in database"&&console.error("Verification check error:",C),k?(f||await w(i,!0),t("success"),a("Email verified successfully! Your account is now active."),m(),u()):y&&!f?(await w(i,!0),t("success"),a("Email verified successfully! Database updated."),m(),u()):(t("checking_verification"),a("Email verification in progress... Checking status."),D(0),setTimeout(()=>{Y(i,n,0)},3e3))}else{const{verified:o,dbVerified:k,authVerified:f}=await p(i,n);if(o)S();else if(f&&!k)await w(i,!0),t("success"),a("Email verification completed! Database updated."),m(),u();else{t("pending"),a(`Registration completed! We've sent a verification email to ${i}. Please check your inbox and click the link to activate your account.`);const y=setInterval(async()=>{const{verified:C,dbVerified:K,authVerified:Q}=await p(i,n);C?(clearInterval(y),S()):Q&&!K&&(clearInterval(y),await w(i,!0),S())},5e3);setTimeout(()=>{clearInterval(y),d==="pending"&&(t("unverified"),a(`Verification is taking longer than expected. Please check your email at ${i} and click the verification link.`))},3e5)}}}catch(i){console.error("Auth callback error:",i),t("error"),a("Something went wrong. Please try registering again.")}},c=setTimeout(()=>{s()},1e3);return()=>clearTimeout(c)},[j,_]);const I=async()=>{try{if(!l)return;t("loading"),a("Sending verification email...");const{error:s}=await V.auth.resend({type:"signup",email:l,options:{emailRedirectTo:`${window.location.origin}/verification`}});if(s)throw s;t("pending"),a(`âœ… Verification email resent to ${l}. Please check your inbox.`)}catch(s){console.error("Error resending verification:",s),t("error"),a("âŒ Failed to resend verification email. Please try again.")}},P=async()=>{try{t("checking_verification"),a("Checking verification status...");const{verified:s,dbVerified:c,authVerified:i}=await p(l,L);s?(t("success"),a("âœ… Email verified! Your account is now active."),m(),u()):i&&!c?(await w(l,!0),t("success"),a("âœ… Email verification completed! Database updated."),m(),u()):(t("unverified"),a(`âŒ Email not verified yet. Please check your email at ${l} and click the verification link.`))}catch(s){console.error("Error checking verification:",s),t("error"),a("Failed to check verification status.")}},R=()=>{const s=["https://mail.google.com/mail/u/0/#search/from%3Anoreply%40supabase.co+OR+from%3Anoreply%40supabase.io","https://outlook.live.com/mail/inbox","https://mail.yahoo.com","https://icloud.com/mail"];window.open(s[0],"_blank"),a(`âœ… Opened email client. Please check your inbox at ${l}`)},B=()=>{j("/verification",{state:{email:l,userId:L}})},G=()=>{m(),j("/login",{state:{message:"Redirected to login page."}})};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 px-4",children:e.jsx(ae,{className:"w-full max-w-md p-8 shadow-xl",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-6 text-center",children:[d==="loading"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-20 w-20 rounded-full border-4 border-primary/20"}),e.jsx(b,{className:"h-20 w-20 absolute inset-0 m-auto animate-spin text-primary"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Processing..."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Completing your registration. Please wait."})]})]}),d==="already_verified"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center",children:e.jsx(g,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Already Verified! âœ…"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:v}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Email already verified"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Account is ready to use"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(b,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Redirecting to login in ",$," seconds..."]})]})]})]}),e.jsx("div",{className:"space-y-4 w-full",children:e.jsxs(r,{onClick:G,className:"w-full",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Go to Login Now"]})})]}),d==="checking_verification"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-20 w-20 rounded-full border-4 border-primary/20"}),e.jsx(b,{className:"h-20 w-20 absolute inset-0 m-auto animate-spin text-primary"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Checking Verification"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:v}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(b,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Verifying email confirmation..."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(q,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:"Checking database status..."})]})]})]})]}),d==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx(E,{className:"h-10 w-10 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Check Your Email! ðŸ“§"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:v}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Account created successfully"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(E,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Verification email sent to ",l]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(b,{className:"h-4 w-4 animate-spin text-amber-500"}),e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:"Waiting for email verification"})]})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs(r,{onClick:R,variant:"outline",className:"w-full",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Open Email Client"]}),e.jsxs(r,{onClick:P,variant:"secondary",className:"w-full",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Check Verification Status"]}),e.jsxs(r,{onClick:I,className:"w-full",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Resend Verification Email"]}),e.jsx(r,{onClick:B,variant:"outline",className:"w-full",children:"Go to Verification Page"})]})]}),d==="unverified"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:e.jsx(U,{className:"h-10 w-10 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Verification Required"}),e.jsx("p",{className:"text-muted-foreground mt-4",children:v}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(U,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:"Email not verified yet"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(q,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Cannot log in until email is verified"})]})]})]}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs(r,{onClick:R,variant:"outline",className:"w-full",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Open Email Client"]}),e.jsxs(r,{onClick:P,variant:"secondary",className:"w-full",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Check Verification Status"]}),e.jsxs(r,{onClick:I,className:"w-full",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Resend Verification Email"]}),e.jsx(r,{onClick:B,className:"w-full",children:"Go to Verification Page"})]})]}),d==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center",children:e.jsx(ne,{className:"h-10 w-10 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Email Verified! âœ…"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:v}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Account activated successfully"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Database updated"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"You can now log in"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(b,{className:"h-4 w-4 animate-spin text-blue-500"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Redirecting to login in ",$," seconds..."]})]})]})]}),e.jsx("div",{className:"space-y-4 w-full",children:e.jsxs(r,{onClick:G,className:"w-full",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Go to Login Now"]})})]}),d==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(se,{className:"h-10 w-10 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:v})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsxs(r,{onClick:R,variant:"outline",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Check Email"]}),e.jsxs(r,{onClick:P,variant:"outline",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Check Status Again"]}),e.jsxs(r,{variant:"secondary",onClick:I,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Resend Verification Email"]}),e.jsx(r,{variant:"outline",onClick:()=>j("/register"),children:"Try Registration Again"}),e.jsx(r,{onClick:()=>j("/"),children:"Go Home"})]})]})]})})})});export{fe as default};
