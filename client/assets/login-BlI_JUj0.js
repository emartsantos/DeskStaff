import{w as M,v as G,x as D,a as n,p as e,y as q}from"./chunk-EPOLDU6W-BHelFxtI.js";import{B as p}from"./card-DCCwVGqU.js";import{A as T,L as f,I as v,E as $,a as O,t as m}from"./AuthChecker-lr5Qdb8c.js";import{A as R,r as _,C as w,a as H}from"./AuthLayout-_UhsZK27.js";import{A as z,a as B}from"./alert-9_S9W-Db.js";import{s as g}from"./supabase-BO81Wobz.js";import{M as W}from"./mail-BwQk4DBE.js";import{L as U}from"./lock-RqldTzhB.js";import{c as J,L as N}from"./loader-circle-B5kmy_fB.js";import"./index-BRs_dBEV.js";import"./ThemeProvider-1bH72AO7.js";const K=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Q=J("log-in",K),me=M(function(){const S=G();D().state?.from?.pathname;const[a,y]=n.useState({email:"",password:"",rememberMe:!1}),[u,E]=n.useState(!1),[o,t]=n.useState({}),[i,c]=n.useState(!1),[h,b]=n.useState(!1),[Y,Z]=n.useState(!0),k=s=>{const{id:r,value:l,type:d,checked:F}=s.target;y(x=>({...x,[r]:d==="checkbox"?F:l})),o[r]&&t(x=>{const j={...x};return delete j[r],j})};n.useEffect(()=>{document.title="DeskStaff - Login"},[]);const L=()=>{const s={};return a.email.trim()?/\S+@\S+\.\S+/.test(a.email)||(s.email="Please enter a valid email address"):s.email="Email is required",a.password||(s.password="Password is required"),t(s),Object.keys(s).length===0},P=async s=>{if(s.preventDefault(),!!L()){c(!0),t({});try{const{data:r,error:l}=await g.auth.signInWithPassword({email:a.email.toLowerCase().trim(),password:a.password});if(l)throw console.error("Login error:",l),l.message.includes("Invalid login credentials")?new Error("Invalid email or password. Please try again."):l.message.includes("Email not confirmed")?new Error("Please verify your email address before logging in."):l.message.includes("rate limit")?new Error("Too many attempts. Please try again in a few minutes."):new Error(`Login failed: ${l.message}`);if(!r.user)throw new Error("Login failed. Please try again.");try{const{error:d}=await g.from("users").update({logged_in:!0,updated_at:new Date().toISOString()}).eq("id",r.user.id);d&&console.error("Error updating login status:",d)}catch(d){console.error("Error updating login status:",d)}a.rememberMe&&typeof window<"u"&&localStorage.setItem("rememberMe","true"),m.success("Login successful! Redirecting..."),setTimeout(()=>{S(`/profile/${r.user.id}`,{replace:!0})},1e3)}catch(r){console.error("Login error:",r),r instanceof Error?t({submit:r.message}):t({submit:"Login failed. Please try again."})}finally{c(!1)}}},C=async()=>{b(!0),t({});try{const s=window.location.origin,{error:r}=await g.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${s}/auth/google`,queryParams:{access_type:"offline",prompt:"consent"}}});if(r)throw r}catch(s){console.error("Google sign in error:",s),s instanceof Error?t({submit:s.message}):t({submit:"Google sign in failed. Please try again."}),b(!1)}},I=async()=>{if(!a.email){t({email:"Please enter your email address to reset password"});return}if(!/\S+@\S+\.\S+/.test(a.email)){t({email:"Please enter a valid email address"});return}c(!0),t({});try{const{error:r}=await g.auth.resetPasswordForEmail(a.email,{redirectTo:`${window.location.origin}/auth/reset-password`});if(r)throw r;m.success("Password reset email sent! Please check your inbox.")}catch(r){console.error("Forgot password error:",r),m.error("Failed to send reset email. Please try again.")}finally{c(!1)}},A=a.email.includes("@")&&a.password.length>0;return e.jsx(T,{requireAuth:!1,redirectTo:"/profile/:userId",children:e.jsx(R,{illustration:_,illustrationAlt:"Login illustration",gradientFrom:"from-blue-50",gradientTo:"to-indigo-100",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight dark:text-white",children:"Welcome Back"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-gray-400",children:"Please enter your details to sign in."})]}),o.submit&&e.jsxs(z,{variant:"destructive",className:"mb-6",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx(B,{children:o.submit})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",className:"dark:text-gray-300",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"email",type:"email",placeholder:"you@example.com",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 pl-10 ${o.email?"border-red-500 dark:border-red-500":""}`,value:a.email,onChange:k,disabled:i,required:!0}),e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"})]}),o.email&&e.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),o.email]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(f,{htmlFor:"password",className:"dark:text-gray-300",children:"Password"}),e.jsx("button",{type:"button",className:"text-sm text-primary hover:underline dark:text-primary-400",onClick:I,disabled:i,children:"Forgot password?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{id:"password",type:u?"text":"password",placeholder:"••••••••",className:`dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400 pl-10 pr-10 ${o.password?"border-red-500 dark:border-red-500":""}`,value:a.password,onChange:k,disabled:i,required:!0}),e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 disabled:opacity-50",onClick:()=>E(!u),disabled:i,children:u?e.jsx($,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})})]}),o.password&&e.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),o.password]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"rememberMe",checked:a.rememberMe,onCheckedChange:s=>y(r=>({...r,rememberMe:s})),className:"mt-1 dark:border-gray-600 dark:data-[state=checked]:bg-primary",disabled:i}),e.jsx(f,{htmlFor:"rememberMe",className:"font-normal dark:text-gray-400",children:"Remember me for 30 days"})]}),e.jsx(p,{type:"submit",className:"w-full",size:"lg",disabled:i||!A,children:i?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 animate-spin mr-2"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Sign In"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-border dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card dark:bg-gray-800 px-2 text-muted-foreground dark:text-gray-400",children:"Or continue with"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{type:"button",variant:"outline",size:"lg",className:"w-full flex items-center gap-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",onClick:C,disabled:i||h,children:[h?e.jsx(N,{className:"h-5 w-5 animate-spin"}):e.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"Google",className:"h-5 w-5"}),h?"Signing in...":"Sign in with Google"]}),e.jsxs(p,{type:"button",variant:"outline",size:"lg",className:"w-full flex items-center gap-2 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",disabled:i,onClick:()=>m.info("GitHub sign in coming soon!"),children:[e.jsx("img",{src:"https://www.svgrepo.com/show/475661/github-filled.svg",alt:"GitHub",className:"h-5 w-5"}),"Sign in with GitHub"]})]})]}),e.jsxs("p",{className:"mt-8 text-center text-sm text-muted-foreground dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(q,{to:"/register",className:"text-primary font-medium hover:underline dark:text-primary-400",onClick:s=>i&&s.preventDefault(),children:"Sign up here"})]})]})})})});export{me as default};
